This is almost entirely Erik Abele's original code. I've simply updated some of
the Ruby functions to match the 1.9 Ruby C API.
